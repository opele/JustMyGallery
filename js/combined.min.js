function isBlank(e){return!e||/^\s*$/.test(e)}function capitalise(e){return e.charAt(0).toUpperCase()+e.slice(1)}function findIntersection(e,t){return e.filter(function(e){return t.indexOf(e)>-1})}function isViewingImage(){return null!=Galleria.get(0).getActiveImage()&&$(Galleria.get(0).getActiveImage()).is(":visible")}function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}function store(e,t){isLocalStorageAccepted()&&localStorage.setItem(e,t)}var currentFromFilterDate,currentToFilterDate,currentFilterTags,currentFilterCategory,imagesToLoad,numberOfPreviewImagesLoaded=0,numberOfFullSizeImagesLoaded=0,sortByRating=!1,sortByDateAsc=!1,sortByDateDesc=!1,sortByName=!1,filterByNameEnabled=!1,filterByDateEnabled=!1,filterByTagsEnabled=!1,filterByCategoryEnabled=!1,categoriesAndTags=!0,nameFilterFunc=function(e){return!0},tagsFilterFunc=function(e){return!0},categoryFilterFunc=function(e){return!0},dateRangeFilterFunc=function(e){return!0},filterFunction=function(e){return e.filter(function(e){return nameFilterFunc(e)&&(!filterByTagsEnabled||!filterByCategoryEnabled||categoriesAndTags&&tagsFilterFunc(e)&&categoryFilterFunc(e)||!categoriesAndTags&&(tagsFilterFunc(e)||categoryFilterFunc(e)))&&(filterByTagsEnabled&&filterByCategoryEnabled||tagsFilterFunc(e)&&categoryFilterFunc(e))&&dateRangeFilterFunc(e)})};$(function(){refreshSelectableTags(),refreshSelectableCategories()}),$(function(){Galleria.loadTheme("lib/folio/galleria.folio.min.js"),initSidebar(),loadImages()});var scrolledToEnd=!1,lastChunkLoaded=!1;function loadImages(){numberOfPreviewImagesLoaded=0,imagesToLoad=imgData,"function"==typeof filterFunction&&(imagesToLoad=filterFunction(imagesToLoad)),imagesToLoad.sort(sortImages),Galleria.run(".galleria",{dataSource:imagesToLoad.slice(0,30),transition:"pulse",thumbCrop:"width",imageCrop:!1,carousel:!1,show:!1,easing:"galleriaOut",fullscreenDoubleTap:!1,_webkitCursor:!0,_animate:!1,_center:!0}),window.scrollTo(0,0)}function updateLazyLoadSentinel(){var e=Galleria.get(0),t=$(".galleria-thumbnails");t.append('<div id="sentinel"></div>');var r=$("#sentinel").get(0);new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting?(scrolledToEnd=!0,tryLoadNextChunk()):scrolledToEnd=!1})}).observe(r),e.bind("thumbnail",function(a){++numberOfPreviewImagesLoaded,t.get(0).appendChild(r),a.index==e.getDataLength()-1&&(lastChunkLoaded=!0,tryLoadNextChunk())})}function tryLoadNextChunk(){var e=Galleria.get(0),t=e.getDataLength();if(lastChunkLoaded&&scrolledToEnd&&t<imagesToLoad.length){var r=t+15;r>imagesToLoad.length&&(r=imagesToLoad.length),e.push(imagesToLoad.slice(t,r)),lastChunkLoaded=!1}}function sortImages(e,t){var r=0;if(sortByRating&&(r=sortImagesByRating(e,t)),0==r)if(sortByDateAsc){if(e.timestamp&&t.timestamp)return e.timestamp-t.timestamp}else if(sortByDateDesc){if(e.timestamp&&t.timestamp)return t.timestamp-e.timestamp}else if(sortByName&&e.title&&t.title){var a=e.title.toLowerCase(),n=t.title.toLowerCase();if(a<n)return-1;if(a>n)return 1}return r}function sortImagesByRating(e,t){var r=JSON.parse(localStorage.getItem(e.image)),a=r&&r.rating,n=JSON.parse(localStorage.getItem(t.image)),i=n&&n.rating;return a||i?!a&&i?1:a&&!i?-1:r.rating>n.rating?-1:r.rating<n.rating?1:0:0}function toggleSortByDateAsc(){sortByDateAsc=!sortByDateAsc,sortByDateDesc=!1,sortByName=!1,refreshSortingUi(),persistSorting(),loadImages()}function toggleSortByDateDesc(){sortByDateDesc=!sortByDateDesc,sortByDateAsc=!1,sortByName=!1,refreshSortingUi(),persistSorting(),loadImages()}function toggleSortByName(){sortByName=!sortByName,sortByDateDesc=!1,sortByDateAsc=!1,refreshSortingUi(),persistSorting(),loadImages()}function toggleSortByRating(){sortByRating=!sortByRating,$("#sortByRatingSwitch").prop("checked",sortByRating),persistSorting(),loadImages()}function refreshSortingUi(){$("#sortByDateAscSwitch").prop("checked",sortByDateAsc),$("#sortByDateDescSwitch").prop("checked",sortByDateDesc),$("#sortByNameSwitch").prop("checked",sortByName),$("#sortByRatingSwitch").prop("checked",sortByRating)}function persistSorting(){store("sortByRating",sortByRating),store("sortByDateAsc",sortByDateAsc),store("sortByDateDesc",sortByDateDesc),store("sortByName",sortByName)}function filterByName(){var e=$("#inputNameFilter").val();filterByNameEnabled=!isBlank(e),applyFilterByName(e),store("filterByNameEnabled",filterByNameEnabled),store("currentFilterByName",e),loadImages()}function applyFilterByName(e){nameFilterFunc=filterByNameEnabled?function(t){return t.title&&t.title.toLowerCase().includes(e.toLowerCase())}:function(e){return!0},displayAsActive(filterByNameEnabled,$("#nameFilterContainer").get(0))}function filterByDateRange(){filterFrom=document.getElementById("inputDateFromFilter").valueAsNumber,filterTo=document.getElementById("inputDateToFilter").valueAsNumber,(filterFrom===currentFromFilterDate||isNaN(filterFrom)&&isNaN(currentFromFilterDate))&&(filterTo===currentToFilterDate||isNaN(filterTo)&&isNaN(currentToFilterDate))||(currentFromFilterDate=filterFrom,currentToFilterDate=filterTo,filterByDateEnabled=!((isBlank(filterFrom)||isNaN(filterFrom))&&(isBlank(filterTo)||isNaN(filterTo))),applyFilterByDateRange(),store("filterByDateEnabled",filterByDateEnabled),store("currentFromFilterDate",currentFromFilterDate),store("currentToFilterDate",currentToFilterDate),loadImages())}function applyFilterByDateRange(){var e=currentFromFilterDate,t=currentToFilterDate;filterByDateEnabled?((isBlank(e)||isNaN(e))&&(e=-1),(isBlank(t)||isNaN(t))&&(t=Number.MAX_VALUE),dateRangeFilterFunc=function(r){return r.timestamp&&r.timestamp>=e&&r.timestamp<=t}):dateRangeFilterFunc=function(e){return!0},displayAsActive(filterByDateEnabled,$("#dateFilterContainer").get(0))}function filterFromDateChanged(){var e=document.getElementById("inputDateFromFilter").valueAsNumber;(isBlank(e)||isNaN(e))&&filterByDateRange()}function filterToDateChanged(){var e=document.getElementById("inputDateToFilter").valueAsNumber;(isBlank(e)||isNaN(e))&&filterByDateRange()}function filterByTags(){var e=$("#tagsFilter").val();arraysEqual(e,currentFilterTags)||(currentFilterTags=e,filterByTagsEnabled=e&&e.length>0,applyFilterByTags(),store("filterByTagsEnabled",filterByTagsEnabled),store("currentFilterTags",currentFilterTags),loadImages())}function applyFilterByTags(){tagsFilterFunc=filterByTagsEnabled?function(e){return e.tags&&findIntersection(e.tags.split(","),currentFilterTags).length>0}:function(e){return!0},displayAsActive(filterByTagsEnabled,$("#tagsFilterContainer").get(0))}function filterByCategory(){var e=$("#categoryFilter").val();e!==currentFilterCategory&&(currentFilterCategory=e,filterByCategoryEnabled=!isBlank(e),applyFilterByCategory(),store("filterByCategoryEnabled",filterByCategoryEnabled),store("currentFilterCategory",currentFilterCategory),loadImages())}function applyFilterByCategory(){categoryFilterFunc=filterByCategoryEnabled?function(e){return e.categories&&e.categories.split(",").includes(currentFilterCategory)}:function(e){return!0},displayAsActive(filterByCategoryEnabled,$("#categoryFilterContainer").get(0))}function toggleTagsAndCategoryFilter(){categoriesAndTags=!categoriesAndTags,applyTagsAndCategoryFilter(),store("categoriesAndTags",categoriesAndTags),filterByCategoryEnabled&&filterByTagsEnabled&&loadImages()}function applyTagsAndCategoryFilter(){categoriesAndTags?$("#toggleTagsAndCategoryFilterBtn").html("Tags AND Category"):$("#toggleTagsAndCategoryFilterBtn").html("Tags OR Category")}function openSidebar(){$("#sidebarOpenBtn").hide(),document.getElementById("sidebar-container").style.left="0px"}function closeSidebar(){document.getElementById("sidebar-container").style.left="-250px",$("#sidebarOpenBtn").show(500)}function displayAsActive(e,t){e?(t.classList.remove("bg-dark"),t.classList.add("active")):(t.classList.remove("active"),t.classList.add("bg-dark"))}function initSidebar(){var e=null;isLocalStorageAccepted()&&(sortByRating="true"==localStorage.getItem("sortByRating"),sortByDateAsc="true"==localStorage.getItem("sortByDateAsc"),sortByDateDesc="true"==localStorage.getItem("sortByDateDesc"),sortByName="true"==localStorage.getItem("sortByName"),filterByNameEnabled="true"==localStorage.getItem("filterByNameEnabled"),e=localStorage.getItem("currentFilterByName"),filterByDateEnabled="true"==localStorage.getItem("filterByDateEnabled"),currentFromFilterDate=parseInt(localStorage.getItem("currentFromFilterDate")),currentToFilterDate=parseInt(localStorage.getItem("currentToFilterDate")),filterByTagsEnabled="true"==localStorage.getItem("filterByTagsEnabled"),currentFilterTags=localStorage.getItem("currentFilterTags"),filterByCategoryEnabled="true"==localStorage.getItem("filterByCategoryEnabled"),currentFilterCategory=localStorage.getItem("currentFilterCategory"),categoriesAndTags="true"==localStorage.getItem("categoriesAndTags")),refreshSortingUi(),$("#inputNameFilter").val(e),applyFilterByName(e),document.getElementById("inputDateFromFilter").valueAsNumber=currentFromFilterDate,document.getElementById("inputDateToFilter").valueAsNumber=currentToFilterDate,applyFilterByDateRange(),null!=currentFilterTags&&currentFilterTags.length>0&&$("#tagsFilter").selectpicker("val",currentFilterTags.split(",")),applyFilterByTags(),isBlank(currentFilterCategory)||$("#categoryFilter").selectpicker("val",currentFilterCategory),applyFilterByCategory(),applyTagsAndCategoryFilter()}function toggleDisplaySidebarElementInForeground(e,t){$("#sidebar-container > ul > div").each(function(r){t?e.is($(this))||$(this).css("z-index",0):$(this).css("z-index",2)})}function refreshSelectableTags(){var e=new Set;imgData.forEach(function(t){t.tags&&t.tags.split(",").forEach(t=>e.add(t))}),$("#tagsFilter").empty(),e.forEach(function(e){$("#tagsFilter").append('<option value="'+e+'">'+e+"</option>")}),$("#tagsFilter").selectpicker("refresh")}function refreshSelectableCategories(){var e=new Set;imgData.forEach(function(t){t.categories&&t.categories.split(",").forEach(t=>e.add(t))}),$("#categoryFilter").empty(),e.forEach(function(e){$("#categoryFilter").append('<option value="'+e+'">'+capitalise(e)+"</option>")}),$("#categoryFilter").selectpicker("refresh")}function displayRating(e){var t=$(".galleria-info").find("#rating");0===t.length&&(t=$(".galleria-info").append(ratingHtml).find("#rating")),t.on("keydown keyup keyleft keyright","input",function(e){e.preventDefault()});var r=JSON.parse(localStorage.getItem(e.getAttribute("src")));refreshRating(t,null==r?null:r.rating)}function rateImage(e,t){if(isLocalStorageAccepted()){var r=Galleria.get(0),a=r.getData(r.getIndex());a&&localStorage.setItem(a.image,'{"rating":'+t+"}"),refreshRating($(e.target.parentElement),t)}else alert("Unable to remember new rating without permission to use local browser storage.")}function refreshRating(e,t){e.children("span").each(function(e){var r=t&&e<t;$(this).get(0).className=r?"fa fa-star checked":"fa fa-star unchecked"})}Galleria.ready(function(e){scrolledToEnd=!1,lastChunkLoaded=!1,updateLazyLoadSentinel()}),$(function(){$(window).keydown(function(e){isViewingImage()?processKeyEvtForRating(e):"Escape"==e.key?closeSidebar():"1"==e.key&&openSidebar()})}),$(function(){$("#sortByDateAscButton").on("click",function(e){toggleSortByDateAsc()}),$("#sortByDateAscButton").on("keydown",function(e){"Enter"==event.key&&(event.preventDefault(),toggleSortByDateAsc())}),$("#sortByDateAscSwitch").on("click",function(e){return!1}),$("#sortByDateDescButton").on("click",function(e){toggleSortByDateDesc()}),$("#sortByDateDescButton").on("keydown",function(e){"Enter"==event.key&&(event.preventDefault(),toggleSortByDateDesc())}),$("#sortByDateDescSwitch").on("click",function(e){return!1}),$("#sortByNameButton").on("click",function(e){toggleSortByName()}),$("#sortByNameButton").on("keydown",function(e){"Enter"==event.key&&(event.preventDefault(),toggleSortByName())}),$("#sortByNameSwitch").on("click",function(e){return!1}),$("#sortByRatingButton").on("click",function(e){toggleSortByRating()}),$("#sortByRatingButton").on("keydown",function(e){"Enter"==event.key&&(event.preventDefault(),toggleSortByRating())}),$("#sortByRatingSwitch").on("click",function(e){return!1})}),$("#inputNameFilter").keypress(function(e){"Enter"==e.key&&(e.preventDefault(),filterByName(),$('[data-toggle="tooltip"]').tooltip("hide"))}),$(function(){$(".bs-select-clear-selected").click(function(){currentFilterCategory=null,categoryFilterFunc=function(e){return!0},displayAsActive(filterByCategoryEnabled=!1,$("#categoryFilterContainer").get(0)),store("filterByCategoryEnabled",filterByCategoryEnabled),store("currentFilterCategory",currentFilterCategory),loadImages()})}),$(function(){$("#closeSidebarBtn").keydown(function(e){"Enter"==e.key&&closeSidebar()})}),$(function(){$("#tagsFilter").on("show.bs.select",function(e){toggleDisplaySidebarElementInForeground($("#tagsFilterContainer"),!0)}),$("#tagsFilter").on("hide.bs.select",function(e){toggleDisplaySidebarElementInForeground($("#tagsFilterContainer"),!1),filterByTags()}),$("#tagsFilter + button.btn.dropdown-toggle").keydown(function(e){var t=$("#tagsFilter");t.parent().hasClass("show")?"ArrowLeft"==e.key&&t.selectpicker("toggle"):"Backspace"==e.key&&(t.selectpicker("deselectAll"),filterByTags())})}),$(function(){$("#categoryFilter").on("show.bs.select",function(e){toggleDisplaySidebarElementInForeground($("#categoryFilterContainer"),!0)}),$("#categoryFilter").on("hide.bs.select",function(e){toggleDisplaySidebarElementInForeground($("#categoryFilterContainer"),!1),filterByCategory()}),$("#categoryFilter + button.btn.dropdown-toggle").keydown(function(e){var t=$("#categoryFilter");t.parent().hasClass("show")?"ArrowLeft"==e.key&&t.selectpicker("toggle"):"Backspace"==e.key&&t.val().length>0&&$(".bs-select-clear-selected").click()})});var ratingHtml='<div id="rating" class="rate"><span class = "fa fa-star unchecked" onclick=\'rateImage(event, 1)\'></span><span class = "fa fa-star unchecked" onclick=\'rateImage(event, 2)\'></span><span class = "fa fa-star unchecked" onclick=\'rateImage(event, 3)\'></span><span class = "fa fa-star unchecked" onclick=\'rateImage(event, 4)\'></span><span class = "fa fa-star unchecked" onclick=\'rateImage(event, 5)\'></span></div>';function processKeyEvtForRating(e){var t=$(".galleria-info").find("#rating");"1"==e.key?t.children("span").get(0).click():"2"==e.key?t.children("span").get(1).click():"3"==e.key?t.children("span").get(2).click():"4"==e.key?t.children("span").get(3).click():"5"==e.key&&t.children("span").get(4).click()}var scrollDistance=170;function hideImageSizeRange(){var e=$("#imageSizeRange");e.length&&e.css("display","none")}function applyScaleToImg(e,t){var r=t.naturalHeight*e+"px",a=t.naturalWidth*e+"px";t.style.height=r,t.style.width=a,t.width=a,t.height=r}function resetFullSizeView(e,t){var r=$("#fullSizeImage").get(0);hideImageSizeRange(),r.parentElement.parentElement.style.overflow="hidden",r.parentElement.style.overflow="hidden",r.parentElement.style.height="100%",r.parentElement.style.width="100%",r.parentElement.style.position="absolute",r.style.height="100%",r.style.width="100%",r.height="",r.width="",r.style.margin="",r.style.position="absolute",r.style.overflow="hidden",r.id=null,t.refreshImage()}$(window).on("mousewheel DOMMouseScroll",function(e){if($("#fullSizeImage").length&&"none"!=$("#fullSizeImage").get(0).style.display){var t=$(".galleria-images").get(0);if(e.preventDefault(),e.shiftKey){var r=$("#imageSizeRange");if(r.length){var a=e.originalEvent.wheelDelta/120||-e.originalEvent.detail/3;r.val(r.val()-.04*a),r.change()}}else{a=e.originalEvent.wheelDelta/120||-e.originalEvent.detail/3;t.scrollTop-=parseInt(a*scrollDistance)}}}),Galleria.on("fullscreen_exit",function(e){hideImageSizeRange()}),Galleria.on("image",function(e){++numberOfFullSizeImagesLoaded,$(".galleria-info").css("left","0px");var t=this;displayRating(e.imageTarget),$("#fullSizeImage").length&&resetFullSizeView(e,t),e.imageTarget.parentElement.onclick=function(){if($("#fullSizeImage").length)resetFullSizeView(e,t);else{currentImg=e.imageTarget,currentImg.id="fullSizeImage",currentImg.parentElement.parentElement.style.overflow="auto",currentImg.parentElement.style.overflow="",currentImg.parentElement.style.height="auto",currentImg.parentElement.style.width="auto",currentImg.parentElement.style.position="",currentImg.style.height="auto",currentImg.style.width="auto",currentImg.height="auto",currentImg.width="auto",currentImg.style.margin="auto",currentImg.style.position="",currentImg.style.overflow="auto",$(".galleria-image-nav").css("pointer-events","none"),$(".galleria-image-nav-right").css("pointer-events","auto"),$(".galleria-image-nav-left").css("pointer-events","auto"),$(".galleria-image-nav").css("width","99%");let t=1.5,n=.8*document.documentElement.clientWidth/currentImg.clientWidth;n>t&&(n=t);var r=$("#imageSizeRange");if(r.length)r.css("display","block");else{var a='<input type="range" class="form-range image-size-range" min="0.1" max="'+t+'" step="0.01" id="imageSizeRange" data-toggle="tooltip" data-placement="bottom" title="Use Shift + Mousewheel">';$(".galleria-container").append(a),r=$("#imageSizeRange")}r.css("display","block"),r.on("input change",function(){applyScaleToImg(r.val(),currentImg)}),r.val(n),applyScaleToImg(r.val(),currentImg)}}});